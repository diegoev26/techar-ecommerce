"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_rollupPluginBabelHelpers-7d3a169b.js"),n=require("react"),r=require("file-selector");function t(t){var l=t.accept,i=void 0===l?"*":l,o=t.multiple,a=void 0===o||o,c=t.readAs,u=void 0===c?"Text":c,s=t.readFilesContent,f=void 0===s||s,d=t.validators,p=void 0===d?[]:d,v=t.initializeWithCustomParameters,F=n.useState([]),m=F[0],y=F[1],C=n.useState([]),h=C[0],S=C[1],x=n.useState([]),g=x[0],b=x[1],k=n.useState(!1),_=k[0],P=k[1],R=function(e){var n=e.onFilesSelected,r=e.onFilesSuccessfullySelected,t=e.onFilesRejected,l=e.onClear,i=e.validators;return{onFilesSelected:function(e){null==n||n(e),null==i||i.forEach((function(n){n.onFilesSelected(e)}))},onFilesSuccessfullySelected:function(e){null==r||r(e),null==i||i.forEach((function(n){n.onFilesSuccessfullySelected(e)}))},onFilesRejected:function(e){null==t||t(e),null==i||i.forEach((function(n){n.onFilesRejected(e)}))},onClear:function(){null==l||l(),null==i||i.forEach((function(e){null==e.onClear||e.onClear()}))}}}(t),E=R.onFilesSelected,j=R.onFilesSuccessfullySelected,w=R.onFilesRejected,A=R.onClear,B=n.useCallback((function(){y([]),S([]),b([])}),[]),M=n.useCallback((function(){B(),null==A||A()}),[B,A]),T=function(n){return new Promise(function(){var r=e._asyncToGenerator(e._regeneratorRuntime().mark((function r(l,i){var o,a;return e._regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:(o=new FileReader)["readAs"+u].call(o,n),a=function(n){var r=e._extends({},(e._objectDestructuringEmpty(n),n));i(e._extends({},r))},o.onload=e._asyncToGenerator(e._regeneratorRuntime().mark((function r(){return e._regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.all(p.map((function(e){return e.validateAfterParsing(t,n,o).catch((function(e){return Promise.reject(a(e))}))}))).then((function(){return l(e._extends({},n,{content:o.result,name:n.name,lastModified:n.lastModified}))})).catch((function(){})));case 1:case"end":return r.stop()}}),r)}))),o.onerror=function(){a({name:"FileReaderError",readerError:o.error,causedByFile:n})};case 6:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}())};return{openFilePicker:function(){!function(e,n,r,t){var l=document.createElement("input");l.style.display="none",document.body.appendChild(l),l.type="file","*"!==e&&(l.accept=e),l.multiple=n,l.addEventListener("change",(function(e){r(e),document.body.removeChild(l)})),t&&t(l),l.dispatchEvent(new MouseEvent("click"))}(i instanceof Array?i.join(","):i,a,function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(l){var i,o,a,c,u,s;return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(),o=(i=l.target).files?Array.from(i.files):[],P(!0),e.next=6,Promise.all(p.map((function(e){return e.validateBeforeParsing(t,o).catch((function(e){return Array.isArray(e)?e:[e]}))})));case 6:if(a=e.sent.flat(1).filter(Boolean),y(o),b(a),!a.length){e.next=15;break}return P(!1),y([]),null==w||w({errors:a}),null==E||E({errors:a}),e.abrupt("return");case 15:if(f){e.next=19;break}return P(!1),null==E||E({plainFiles:o,filesContent:[]}),e.abrupt("return");case 19:return e.next=21,r.fromEvent(l);case 21:return c=e.sent,u=[],e.next=25,Promise.all(c.map((function(e){return T(e).catch((function(e){u.push.apply(u,Array.isArray(e)?e:[e])}))})));case 25:if(s=e.sent,P(!1),!u.length){e.next=34;break}return y([]),S([]),b((function(e){return[].concat(e,u)})),null==w||w({errors:u}),null==E||E({errors:a.concat(u)}),e.abrupt("return");case 34:S(s),y(o),b([]),null==j||j({filesContent:s,plainFiles:o}),null==E||E({plainFiles:o,filesContent:s});case 39:case"end":return e.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),v)},filesContent:h,errors:g,loading:_,plainFiles:m,clear:M}}exports.useFilePicker=t,exports.useImperativeFilePicker=function(r){var l=r.readFilesContent,i=r.onFilesSelected,o=r.onFilesSuccessfullySelected,a=n.useState([]),c=a[0],u=a[1],s=n.useState([]),f=s[0],d=s[1],p=t(e._extends({},r,{onFilesSelected:function(e){var n;if(i)return null!=(n=e.errors)&&n.length?i(e):void i({errors:void 0,plainFiles:[].concat(c,e.plainFiles||[]),filesContent:[].concat(f,e.filesContent||[])})},onFilesSuccessfullySelected:function(e){u((function(n){return n.concat(e.plainFiles)})),d((function(n){return n.concat(e.filesContent)})),o&&o({plainFiles:[].concat(c,e.plainFiles||[]),filesContent:[].concat(f,e.filesContent||[])})}})),v=p.openFilePicker,F=p.loading,m=p.errors,y=p.clear,C=n.useCallback((function(){y(),u([]),l&&d([])}),[y,l]),h=n.useCallback((function(e){var n;u((function(n){return[].concat(n.slice(0,e),n.slice(e+1))})),d((function(n){return[].concat(n.slice(0,e),n.slice(e+1))})),null==(n=r.validators)||n.forEach((function(n){return null==n.onFileRemoved?void 0:n.onFileRemoved(e)}))}),[r.validators]),S=n.useCallback((function(e){var n=c.findIndex((function(n){return n===e}));-1!==n&&h(n)}),[h,c]);return{openFilePicker:v,plainFiles:c,filesContent:f,loading:F,errors:m,clear:C,removeFileByIndex:h,removeFileByReference:S}};
//# sourceMappingURL=index.cjs.production.min.js.map
